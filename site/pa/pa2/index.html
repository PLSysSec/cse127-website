



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
        <meta name="author" content="Deian Stefan">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-3.2.0">
    
    
      
        <title>Assignment 2 - Computer Security</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.572ca0f0.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-palette.22915126.css">
      
      
        
        
        <meta name="theme-color" content="#3f51b5">
      
    
    
      <script src="../../assets/javascripts/modernizr.8c900955.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../../css/extra.css">
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#assignment-2-100-pts" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="Computer Security" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                Computer Security
              </span>
              <span class="md-header-nav__topic">
                Assignment 2
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../.." title="Computer Security" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Computer Security
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="About" class="md-nav__link">
      About
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../syllabus/" title="Syllabus" class="md-nav__link">
      Syllabus
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" checked>
    
    <label class="md-nav__link" for="nav-3">
      Assignments
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Assignments
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../pa1/" title="Assignment 1" class="md-nav__link">
      Assignment 1
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Assignment 2
      </label>
    
    <a href="./" title="Assignment 2" class="md-nav__link md-nav__link--active">
      Assignment 2
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#getting-started" title="Getting Started" class="md-nav__link">
    Getting Started
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vm-image" title="VM Image" class="md-nav__link">
    VM Image
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#submission-script" title="Submission Script" class="md-nav__link">
    Submission Script
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#assignment-files" title="Assignment Files" class="md-nav__link">
    Assignment Files
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#assignment-instructions" title="Assignment Instructions" class="md-nav__link">
    Assignment Instructions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exploit-generation" title="Exploit Generation" class="md-nav__link">
    Exploit Generation
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#generating-the-targets" title="Generating the Targets" class="md-nav__link">
    Generating the Targets
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-gdb" title="Using GDB" class="md-nav__link">
    Using GDB
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exploit-notes" title="Exploit Notes" class="md-nav__link">
    Exploit Notes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../contact/" title="Contact information" class="md-nav__link">
      Contact information
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#getting-started" title="Getting Started" class="md-nav__link">
    Getting Started
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vm-image" title="VM Image" class="md-nav__link">
    VM Image
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#submission-script" title="Submission Script" class="md-nav__link">
    Submission Script
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#assignment-files" title="Assignment Files" class="md-nav__link">
    Assignment Files
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#assignment-instructions" title="Assignment Instructions" class="md-nav__link">
    Assignment Instructions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exploit-generation" title="Exploit Generation" class="md-nav__link">
    Exploit Generation
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#generating-the-targets" title="Generating the Targets" class="md-nav__link">
    Generating the Targets
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-gdb" title="Using GDB" class="md-nav__link">
    Using GDB
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exploit-notes" title="Exploit Notes" class="md-nav__link">
    Exploit Notes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="assignment-2-100-pts">Assignment 2 <em>(100 pts)</em><a class="headerlink" href="#assignment-2-100-pts" title="Permanent link">&para;</a></h1>
<p><strong>Deadline: Sunday, February 10, 2019 by 11:59:59 PM</strong></p>
<p><strong>Early Turn-In: Thursday, February 7, 2019 by 11:59:59 PM (10% bonus)</strong></p>
<p>The goal of this assignment is to gain hands-on experience with the effects of buffer 
overflows and other memory-safety bugs. 
You will be provided a skeleton for implementing these exploits in C. 
You must not discuss your solution with other students until three days after the assignment deadline. 
You may consult any online references you wish. 
If you use any code in your answer that you did not write yourself, you must document that fact. 
Failure to do so will be considered a violation of the academic integrity policy.</p>
<h2 id="getting-started">Getting Started<a class="headerlink" href="#getting-started" title="Permanent link">&para;</a></h2>
<p>To complete this assignment you will be provided with a VirtualBox VM and a set of files including a turn-in script.</p>
<h3 id="vm-image">VM Image<a class="headerlink" href="#vm-image" title="Permanent link">&para;</a></h3>
<p>In order to match the environment in which your submission will be graded, 
all work for this assignment must be done on the VirtualBox VM we have provided named cfbox. 
Do not create a VM in the Virtualbox software and then load the image from the link below. 
Instead, double click on the file provided below to initialize a VM with the proper configuration. 
You can download the VM image <a href="https://drive.google.com/file/d/1IGTFd60VijSqUw3r_pOSBBSj5-qt02-7/view?usp=sharing"><strong>here</strong></a>.</p>
<p>The VM is configured with two users: <code>student</code>, with password <code>hacktheplanet</code>; and <code>root</code>, with
password <code>hackallthethings</code>. The VM is configured with SSH on port 2222. Please note that SSH is
disabled for <code>root</code>, so you can only SSH in as the <code>student</code> user. You can still log in as <code>root</code>
using <code>su</code> or by logging into the VM directly.</p>
<p>To SSH into the VM:</p>
<pre><code>ssh -p 2222 student@127.0.0.1
</code></pre>

<p>To copy files from your computer to the VM:</p>
<pre><code>scp -P 2222 -r /path/to/files/ student@127.0.0.1:/home/student
</code></pre>

<p>To copy files from the VM to your computer:</p>
<pre><code>scp -P 2222 student@127.0.0.1:/path/to/files/ /destination/path
</code></pre>

<h3 id="submission-script">Submission Script<a class="headerlink" href="#submission-script" title="Permanent link">&para;</a></h3>
<p><strong>INSERT TEXT FROM MICHAEL</strong></p>
<h3 id="assignment-files">Assignment Files<a class="headerlink" href="#assignment-files" title="Permanent link">&para;</a></h3>
<p>Starter files are provided in an archive on the class webpage. 
It contains exploit starter code (in the <code>sploits</code> directory) for each of the 4 vulnerable programs (in the targets directory). 
Additionally included with the exploits is <code>shellcode.h</code>, which gives Aleph One’s shellcode. 
The <code>sploits</code> directory contains a <code>Makefile</code> to build the expoits. 
The <code>targets</code> directory contains a <code>Makefile</code> to generate targets specific to your PID, 
and a folder called <code>base</code> that you should not modify as these are what are used to generate your targets.</p>
<h2 id="assignment-instructions">Assignment Instructions<a class="headerlink" href="#assignment-instructions" title="Permanent link">&para;</a></h2>
<p>You will be writing an exploit for each of the 4 vulnerable programs provided in the assignment. 
Each exploit, when run in the VM with its target installed setuid-root in <code>/tmp</code>, 
should yield a root shell <code>(/bin/sh)</code>. You can verify this by typing <code>whoami</code> in the root shell, 
to which you should see the response <code>root</code>. You must use Aleph One’s shellcode in <code>shellcode.h</code>, 
as this will be used in the grading scripts. Additionally, for each exploit, provide a brief description of how it works in the <code>writeup.txt</code> file.</p>
<h2 id="exploit-generation">Exploit Generation<a class="headerlink" href="#exploit-generation" title="Permanent link">&para;</a></h2>
<p>To complete the assignment, you will first need to generate targets specific to your PID, then use GDB to find vulnerabilities in the targets, then build your exploits.</p>
<h3 id="generating-the-targets">Generating the Targets<a class="headerlink" href="#generating-the-targets" title="Permanent link">&para;</a></h3>
<p>The first step to generate your targets is to fill in the PID file. 
Then run <code>make generate</code> in the <code>targets</code> directory to create the 4 target source files specific to you: 
<code>target1.c</code> through <code>target4.c</code>. Then run <code>make</code> to build the target binaries: 
<code>target1</code> through <code>target4</code>. Then run <code>make install</code> to copy the binaries into the <code>/tmp</code> directory.
To make the binaries as setuid-root, use <code>su</code> to launch a root shell, 
and then <code>make install</code> and <code>make setuid</code>. Don’t forget to exit your root shell when you’re done, returning you to the user shell.</p>
<h2 id="using-gdb">Using GDB<a class="headerlink" href="#using-gdb" title="Permanent link">&para;</a></h2>
<p>To run an exploit in GDB, run e.g., <code>gdb -e sploit1 -s /tmp/target1</code> to execute <code>sploit1</code> and use the symbol file <code>target1</code>. I recommend the following workflow in GDB:</p>
<ol>
<li><strong>Starting.</strong> Set breakpoints that you can later use for analysis:<ul>
<li><code>b foo</code> &mdash; break at function <code>foo</code></li>
<li><code>b *0x08048489</code> &mdash; break at the instruction at address 0x08048489</li>
<li><code>r</code> &mdash; run the executable</li>
</ul>
</li>
<li><strong>Analyzing.</strong> Examine memory, registers, etc; disassemble code; show stack frames, backtrace,
   etc; and more:<ul>
<li><code>disas foo</code> &mdash; disassemble function <code>foo</code></li>
<li><code>i r</code> &mdash; view registers</li>
<li><code>where</code> &mdash; view stack frames</li>
<li><code>x &lt;loc&gt;</code> &mdash; examine memory</li>
<li><code>x $eip</code> &mdash; examine current instruction pointer</li>
<li><code>x /10x $esp</code> &mdash; examine 10 words at top of stack</li>
<li><code>x /10x buf</code> &mdash; examine 10 words in <code>buf</code></li>
<li><code>x /10i $eip</code> &mdash; examine 10 instructions starting at instruction pointer</li>
<li><code>x /10i foo</code> &mdash; examine 10 instructions starting at <code>foo</code></li>
</ul>
</li>
<li><strong>Continuing.</strong> Continue analysis:<ul>
<li><code>c</code> &mdash; continue execution until next breakpoint/watchpoint</li>
<li><code>si</code> &mdash; step to the next instruction</li>
<li><code>s</code> &mdash; step to the next line of source code</li>
</ul>
</li>
</ol>
<p>Note that this is only a cursory overview of GDB; much more info is available from online
resources.</p>
<h3 id="exploit-notes">Exploit Notes<a class="headerlink" href="#exploit-notes" title="Permanent link">&para;</a></h3>
<p>For this assignment you should read and have a solid understanding of Aleph One’s “Smashing the Stack for Fun and Profit”.
Aleph One gives code that calculates addresses on the target’s stack based on addresses on the exploit’s stack. 
However, addresses on the exploit’s stack can change based on how the exploit is executed 
(working directory, arguments, environment, etc.); in my testing, I do not guarantee 
to execute your exploits exactly the same way bash does. You must therefore hard-code target stack locations in your exploits. 
You should not use a function such as <code>get_sp()</code> in the exploits you hand in. 
You should only modify the sploit C files; i.e. your sploits should work with unmodified Makefiles, targets, etc.
In grading, the exploits may be run with a different environment and different working directory. 
Your exploits must work in these cases also. Your exploit programs should not take any command-line arguments.
Shutting down the VM removes the files in /tmp, and if you want to keep them then pause the VM and save its state!</p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../pa1/" title="Assignment 1" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Assignment 1
              </span>
            </div>
          </a>
        
        
          <a href="../../contact/" title="Contact information" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Contact information
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
  <div class="md-footer-social">
    <link rel="stylesheet" href="../../assets/fonts/font-awesome.css">
    
      <a href="https://github.com/PLSysSec/cse127-winter19" class="md-footer-social__link fa fa-github"></a>
    
  </div>

      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.b41f3d20.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
    
    
      
    
  </body>
</html>