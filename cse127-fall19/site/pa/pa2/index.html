



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
        <meta name="author" content="Deian Stefan">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.4.3">
    
    
      
        <title>Assignment 2 - Computer Security</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.30686662.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-palette.a8b3c06d.css">
      
      
        
        
        <meta name="theme-color" content="#3f51b5">
      
    
    
      <script src="../../assets/javascripts/modernizr.74668098.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../../css/extra.css">
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#assignment-2-75-pts-25pts-extra-for-sploit4" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="Computer Security" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Computer Security
            </span>
            <span class="md-header-nav__topic">
              
                Assignment 2
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../.." title="Computer Security" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Computer Security
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="About" class="md-nav__link">
      About
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../syllabus/" title="Syllabus" class="md-nav__link">
      Syllabus
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../contact/" title="Contact Info and Office Hours" class="md-nav__link">
      Contact Info and Office Hours
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4" checked>
    
    <label class="md-nav__link" for="nav-4">
      Assignments
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Assignments
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../pa1/" title="Assignment 1" class="md-nav__link">
      Assignment 1
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Assignment 2
      </label>
    
    <a href="./" title="Assignment 2" class="md-nav__link md-nav__link--active">
      Assignment 2
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#getting-started" class="md-nav__link">
    Getting Started
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vm-image" class="md-nav__link">
    VM Image
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#assignment-files" class="md-nav__link">
    Assignment Files
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exploit-generation" class="md-nav__link">
    Exploit Generation
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#generating-the-targets" class="md-nav__link">
    Generating the Targets
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exploit-notes" class="md-nav__link">
    Exploit Notes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#important-using-the-shellcode" class="md-nav__link">
    IMPORTANT: Using the shellcode
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-gdb" class="md-nav__link">
    Using GDB
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#submission" class="md-nav__link">
    Submission
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#getting-started" class="md-nav__link">
    Getting Started
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vm-image" class="md-nav__link">
    VM Image
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#assignment-files" class="md-nav__link">
    Assignment Files
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exploit-generation" class="md-nav__link">
    Exploit Generation
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#generating-the-targets" class="md-nav__link">
    Generating the Targets
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exploit-notes" class="md-nav__link">
    Exploit Notes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#important-using-the-shellcode" class="md-nav__link">
    IMPORTANT: Using the shellcode
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-gdb" class="md-nav__link">
    Using GDB
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#submission" class="md-nav__link">
    Submission
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="assignment-2-75-pts-25pts-extra-for-sploit4">Assignment 2 <em>75 pts + 25pts extra for sploit4</em><a class="headerlink" href="#assignment-2-75-pts-25pts-extra-for-sploit4" title="Permanent link">&para;</a></h1>
<p><strong>Deadline: Wednesday, October 16, 2019 by 1:59:59 PM</strong></p>
<p><strong>Early Turn-In: Sunday, October 13, 2019 by 11:59:59 PM (10% bonus)</strong></p>
<p>The goal of this assignment is to gain hands-on experience with the effects of buffer overflows and other memory-safety bugs. </p>
<p><strong>sploit1-sploit3 are required. sploit4 is extra credit!</strong></p>
<ul>
<li>You will be provided a skeleton for implementing these exploits in C.</li>
<li>You must not discuss your solution with other students until three days after the assignment deadline.</li>
<li>You may consult any online references you wish.</li>
<li>If you use any code in your answer that you did not write yourself, you must document that fact. Failure to do so will be considered a violation of the academic integrity policy.</li>
</ul>
<h2 id="getting-started">Getting Started<a class="headerlink" href="#getting-started" title="Permanent link">&para;</a></h2>
<p>To complete this assignment you will be provided with a VirtualBox VM and a set of files.</p>
<h3 id="vm-image">VM Image<a class="headerlink" href="#vm-image" title="Permanent link">&para;</a></h3>
<p>In order to match the environment in which your submission will be graded, all work for this assignment must be done on the VirtualBox VM we have provided, named <code>pa2box</code>. You can download the VM image <a href="https://drive.google.com/a/eng.ucsd.edu/uc?id=11GnFuU7-RC8nlwm9oKAlaGHfVquVGKBz&amp;export=download"><strong>here</strong></a>.</p>
<p>Import the <code>pa2box.vbox</code> file into VirtualBox via the <code>Machine</code> &rarr; <code>Add</code> menu item. <em>Don't</em> create a brand-new VirtualBox VM or import the <code>pa2box-data.vmdk</code> file on its own: if you do this, you won't have the correct configuration.</p>
<p>After importing the VM, select it in the VirtualBox sidebar and start it with the green arrow button or the <code>Machine</code> &rarr; <code>Start</code> menu item. The VM is configured with two users: <code>student</code>, with password <code>hacktheplanet</code>; and <code>root</code>, with password <code>hackallthethings</code>. Instead of using the command line through VirtualBox, we recommend that you SSH into your VM from another client. The VM image is configured to expose an SSH server on port 2222 of your system's loopback address (<code>127.0.0.1</code>).</p>
<p>To SSH into the VM (from your host system running VirtualBox, <strong><em>not</em></strong> from inside the VM):</p>
<pre><code>ssh -p 2222 student@127.0.0.1
</code></pre>

<p>To copy files from your computer to the VM:</p>
<pre><code>scp -P 2222 -r /path/to/files/ student@127.0.0.1:/home/student
</code></pre>

<p>To copy files from the VM to your computer:</p>
<pre><code>scp -P 2222 student@127.0.0.1:/path/to/files/ /destination/path
</code></pre>

<p>Please note that SSH is disabled for <code>root</code>, so you can only SSH in as the <code>student</code> user. You can still log in as <code>root</code> using <code>su</code> or by logging into the VM directly.</p>
<h3 id="assignment-files">Assignment Files<a class="headerlink" href="#assignment-files" title="Permanent link">&para;</a></h3>
<p>Starter files are included inside the <code>student</code> home directory of the VM image.</p>
<p>The <code>targets</code> directory contains a <code>Makefile</code> to generate target executables specific to your PID (as well as a folder called <code>base</code>, which you should not modify, used to generate the targets).</p>
<p>Exploit starter code can be found in the <code>sploits1</code>-<code>sploits4</code> directories: one per each of the four vulnerable target programs. Each of these contains a <code>Makefile</code>, a <code>shellcode.h</code> header file providing Aleph One's shellcode, and a <code>sploitN.c</code> file in which you should write your exploit code (in addition to an <code>assignment.toml</code> file, which should not be modified).</p>
<p>You will be writing an exploit for each of the four vulnerable programs provided in the assignment.  Each exploit, when run in the VM with its target installed setuid-root in <code>/tmp</code>,  should yield a root shell (<code>/bin/sh</code>). You can verify that the shell has been launched as <code>root</code> by typing <code>whoami</code>, to which you should see the response <code>root</code>. You <em>must</em> use Aleph One’s shellcode in <code>shellcode.h</code>,  as this will be used in the grading scripts.</p>
<p>For each exploit, in addition to your <code>.c</code> file, please also create a corresponding file <code>writeup.txt</code> containing a brief description of how the exploit works.</p>
<h2 id="exploit-generation">Exploit Generation<a class="headerlink" href="#exploit-generation" title="Permanent link">&para;</a></h2>
<p>To complete the assignment, you will need to: generate targets specific to your PID; use GDB to find vulnerabilities in the targets; and, finally, craft your exploit programs.</p>
<h3 id="generating-the-targets">Generating the Targets<a class="headerlink" href="#generating-the-targets" title="Permanent link">&para;</a></h3>
<p>Run <code>make generate</code> in the <code>targets</code> directory to create the four target source files specific to you. This will prompt you for your student ID (<code>A########</code> or <code>U########</code>), which will be used to randomize portions of the contents of <code>target1.c</code>-<code>target4.c</code>.</p>
<p>Run <code>make</code> to build the target binaries <code>target1</code>-<code>target4</code>.</p>
<p>Run <code>sudo make install</code> to copy the binaries into the <code>/tmp</code> directory.</p>
<p>Finally, run <code>sudo make setuid</code> to mark the binaries as setuid-root. If you forget this step, then your exploits will end up launching a normal shell instead of a root shell!</p>
<h3 id="exploit-notes">Exploit Notes<a class="headerlink" href="#exploit-notes" title="Permanent link">&para;</a></h3>
<p>For this assignment you should read and have a solid understanding of Aleph One’s “Smashing the Stack for Fun and Profit”.</p>
<p>Aleph One gives code that calculates addresses on the target’s stack based on addresses on the exploit’s stack. However, addresses on the exploit’s stack can change based on how the exploit is executed (working directory, arguments, environment, etc.). <strong>You must therefore hard-code target stack locations in your exploits.</strong></p>
<p>You should not use a function such as <code>get_sp()</code> in the exploits you hand in. You should only modify the <code>sploitN.c</code> files and corresponding <code>writeup.txt</code> files; i.e., your exploits should work with unmodified Makefiles, targets, etc. In grading, the exploits may be run with a different environment and different working directory. Your exploits must work in these cases also.  If you hard-code the target's stack locations into your exploit you should be fine. Your exploit programs should not take any command-line arguments.</p>
<p>Shutting down the VM removes the files in /tmp; if you want to keep them, pause the VM and save its state!</p>
<h2 id="important-using-the-shellcode">IMPORTANT: Using the shellcode<a class="headerlink" href="#important-using-the-shellcode" title="Permanent link">&para;</a></h2>
<p>The shellcode is defined for you in <code>shellcode.h</code> inside each <code>sploitN/</code> directory. To use the shellcode in your sploit buffers, please <strong>import the shellcode with <code>#include</code> and copy the contents programatically</strong>. You can do this with <code>memcpy</code>, <code>strcpy</code>, or even just a <code>for</code> loop with array assignments. <strong>Please do NOT manually copy-paste the shellcode string literal into your sploitN.c file</strong>. While the sploit will still work, it may break grading.</p>
<h2 id="using-gdb">Using GDB<a class="headerlink" href="#using-gdb" title="Permanent link">&para;</a></h2>
<p>To run an exploit in GDB, run, e.g., <code>gdb sploit1</code> to execute <code>sploit1</code>.</p>
<p>Note that there are <strong>two executables</strong> when we run these programs, since, e.g., <code>sploit1</code> will execute <code>target1</code>. Because of this, you can use the following sample workflow to get started in GDB:</p>
<ol>
<li><code>b main</code> --- break at <code>main</code> in <code>sploit1.c</code></li>
<li><code>r</code> --- run the executable <code>sploit1</code></li>
<li><code>c</code> --- continue until <code>main</code> in <code>target1.c</code></li>
<li><code>b foo</code> --- set a breakpoint at <code>foo</code> in <code>target1.c</code></li>
</ol>
<p>Note that you will <em>not</em> be able to set breakpoints in <code>targetN</code> until the program has started executing <code>targetN</code>.
That is, e.g., if you tried to run <code>b foo</code> before step 3, you would get the error <code>Function "foo" not defined.</code></p>
<p>Here are some additional GDB commands that may come in handy:</p>
<ul>
<li><code>p var</code> --- prints the value of a variable named <code>var</code></li>
<li><code>p buf</code> --- (if <code>buf</code> is an array) prints the contents of an array named <code>buf</code></li>
<li><code>p &amp;buf</code> --- prints the starting address of an array or variable named <code>buf</code></li>
<li><code>i r</code> --- view registers</li>
<li><code>i frame</code> --- view info about the current stack frame</li>
<li><code>i stack</code> --- view high level info about the</li>
<li><code>help &lt;command&gt;</code> --- get help inside GDB about a particular command</li>
</ul>
<p>Also refer back to the sample commands in Assignment 1.</p>
<p>Note that this is only a cursory overview of GDB; much more info is available from online
resources.</p>
<h3 id="submission">Submission<a class="headerlink" href="#submission" title="Permanent link">&para;</a></h3>
<ol>
<li>Create a file named <code>PID</code> in the student home directory on the VM, and put your PID in it (ex: <code>A12345678</code>)</li>
<li>Run the following command from the student home directory <code>tar -czvf pa2.tar.gz PID sploit[1-4]/ targets/</code> This will create a <code>pa2.tar.gz</code> in the home directory with all your files in it. You can see what files were zipped by running <code>tar -tf pa2.tar.gz</code></li>
<li><code>scp</code> the <code>pa2.tar.gz</code> file to your local computer and submit to gradescope.</li>
</ol>
<p>Note: gradescope's autograder is not being used to grade this assignment, since it requires the environment of the VM. You'll know if your solution works if you are able to get root shells after running each sploit and if you follow the directions above</p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../pa1/" title="Assignment 1" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Assignment 1
              </span>
            </div>
          </a>
        
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
  <div class="md-footer-social">
    <link rel="stylesheet" href="../../assets/fonts/font-awesome.css">
    
      <a href="https://github.com/PLSysSec/cse127-website" class="md-footer-social__link fa fa-github"></a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.ac79c3b0.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
    
  </body>
</html>